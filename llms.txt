# Tektome Python SDK

> Utilities and API client for handling Tektome Resources

## Overview

Tektome is a Python SDK for interacting with the Tektome API. It provides:
1. **Schema classes** - Pydantic models for validating Tektome data structures
2. **API client** - HTTP client for making authenticated requests to Tektome API
3. **API endpoints** - Auto-generated endpoint functions for all Tektome API operations
4. **Data models** - 700+ Pydantic models for API request/response types

## Installation

```bash
pip install git+https://github.com/tektomejp/tektome_python.git@main
```

## Package Structure

```
tektome/
├── __init__.py          # Exports: BaseSchema, Resource, Resources, Project, Projects,
│                        #          AttributeDefinitions, Context, Date, DateTime
├── schema.py            # Core Pydantic schema classes
├── decorators.py        # Validation decorators (parseio)
└── endpoints/
    ├── __init__.py      # Exports: Client, AuthenticatedClient
    ├── client.py        # HTTP client classes (sync and async)
    ├── errors.py        # UnexpectedStatus exception
    ├── types.py         # Shared types: UNSET, File, Response
    ├── api/             # API endpoint modules (40 modules)
    │   ├── access/
    │   ├── account/
    │   ├── attribute/
    │   ├── bim/
    │   ├── chats/
    │   ├── dataspace/
    │   ├── folder/
    │   ├── project/
    │   ├── resource/
    │   ├── search/
    │   └── ... (30 more)
    └── models/          # Data models (700+ classes)
```

## Quick Start

```python
from tektome import Resource, Context
from tektome.decorators import parseio

@parseio
def main(ctx: Context, r: Resource) -> dict:
    print(f"Context: {ctx.model_dump()}")
    print(f"Resource: {r.model_dump()}")
    return {"status": "success"}
```

---

## Usage

These classes convert dictionaries provided by Openflow input to validated Pydantic models.

### The `@parseio` Decorator

The `@parseio` decorator from `tektome.decorators` handles input validation and output serialization:

**Input (arguments):**
- Validates and coerces using Pydantic's `@validate_call` (dicts become models)
- Runtime type-checked via `@beartype`

**Output (return value):**
- Runtime type-checked via `@beartype`
- Pydantic models automatically converted to dict via `.model_dump()`

```python
# requirements:
# git+https://github.com/tektomejp/tektome_python.git@main

from tektome import Resource, Context
from tektome.decorators import parseio
from tektome.endpoints.api.project import create_core_project
from tektome.endpoints.models import CoreProjectPostIn
from pydantic import BaseModel

class Output(BaseModel):
    status: str
    project_id: str

@parseio
def main(ctx: Context, r: Resource, project_name: str) -> Output:
    print(f"type of ctx is: {type(ctx)} with the following data available")
    print(ctx.model_dump())
    print(f"type of r is: {type(r)} with the following data available")
    print(r.model_dump())

    # Create authenticated client from context
    with ctx.client() as client:
        # Create a new project with payload
        payload = CoreProjectPostIn(name=project_name)
        response = create_core_project.sync(client=client, body=payload)
        print(f"Created project: {response}")

    return Output(status="success", project_id=str(response.id))
```

---

## Core Schema Classes

### BaseSchema
Base class for all Tektome schemas. Forbids extra fields to prevent data corruption.

**Configuration:**
- `extra="forbid"` - Rejects any fields not defined in the model

### Resource
Represents a single Tektome resource.

**Fields:**
- `id: UUID` - The unique identifier for the resource
- `kind: str` - Must be "resource"

**Example:**
```python
from tektome import Resource

resource = Resource(
    id="123e4567-e89b-12d3-a456-426614174000",
    kind="resource"
)
```

### Resources
Represents a collection of resource UUIDs.

**Fields:**
- `ids: list[UUID]` - List of resource UUIDs
- `kind: str` - Must be "resource[]"

**Example:**
```python
from tektome import Resources

resources = Resources(
    ids=["123e4567-e89b-12d3-a456-426614174000"],
    kind="resource[]"
)
```

### Project
Represents a single Tektome project.

**Fields:**
- `id: UUID` - The unique identifier for the project
- `kind: str` - Must be "project"

**Example:**
```python
from tektome import Project

project = Project(
    id="123e4567-e89b-12d3-a456-426614174000",
    kind="project"
)
```

### Projects
Represents a collection of project UUIDs.

**Fields:**
- `ids: list[UUID]` - List of project UUIDs
- `kind: str` - Must be "project[]"

**Example:**
```python
from tektome import Projects

projects = Projects(
    ids=["123e4567-e89b-12d3-a456-426614174000"],
    kind="project[]"
)
```

### AttributeDefinitions
Represents a collection of attribute definition UUIDs.

**Fields:**
- `ids: list[UUID]` - List of attribute definition UUIDs
- `kind: str` - Must be "attribute_definition[]"

**Example:**
```python
from tektome import AttributeDefinitions

attr_defs = AttributeDefinitions(
    ids=["123e4567-e89b-12d3-a456-426614174000"],
    kind="attribute_definition[]"
)
```

### Context
Represents the execution context for Tektome operations. Automatically injected by Tektome system.

**Fields:**
- `user_api_key: str` - User's API key for authentication
- `base_url: AnyHttpUrl` - Tektome deployment base URL (e.g., https://gateway.tektome.com)
- `execution_id: UUID` - Execution ID for obtaining additional context

**Methods:**
- `client(**kwargs) -> AuthenticatedClient` - Create an authenticated API client from context

**Example:**
```python
from tektome import Context

ctx = Context(
    user_api_key="your-api-key",
    base_url="https://gateway.tektome.com",
    execution_id="123e4567-e89b-12d3-a456-426614174000"
)

# Create client directly from context (recommended)
with ctx.client() as client:
    # make authenticated requests
    pass

# Or manually construct headers
headers = {"Authorization": f"Bearer {ctx.user_api_key}"}
```

### Date
Represents a date value with kind validation.

**Fields:**
- `value: date` - The date value
- `kind: str` - Must be "date"

**Example:**
```python
from tektome import Date
from datetime import date

date_obj = Date(value=date(2025, 11, 19), kind="date")
```

### DateTime
Represents a datetime value with kind validation.

**Fields:**
- `value: datetime` - The datetime value
- `kind: str` - Must be "datetime"

**Example:**
```python
from tektome import DateTime
from datetime import datetime

dt = DateTime(value=datetime(2025, 11, 19, 10, 30, 0), kind="datetime")
```

---

## API Client

### Client (Unauthenticated)

```python
from tektome.endpoints import Client

client = Client(base_url="https://gateway.tektome.com")

# With context manager (sync)
with Client(base_url="https://gateway.tektome.com") as client:
    # make requests
    pass

# Async usage
async with Client(base_url="https://gateway.tektome.com") as client:
    # make async requests
    pass
```

**Constructor Parameters:**
- `base_url: str` - The base URL for the API
- `cookies: dict[str, str]` - Cookies to send with every request
- `headers: dict[str, str]` - Headers to send with every request
- `timeout: httpx.Timeout` - Request timeout configuration
- `verify_ssl: bool` - Whether to verify SSL certificates (default: True)
- `follow_redirects: bool` - Whether to follow redirects (default: False)
- `httpx_args: dict` - Additional arguments for httpx.Client
- `raise_on_unexpected_status: bool` - Raise on undocumented status codes (default: False)

**Methods:**
- `with_headers(headers: dict) -> Client` - Return client with additional headers
- `with_cookies(cookies: dict) -> Client` - Return client with additional cookies
- `with_timeout(timeout: httpx.Timeout) -> Client` - Return client with new timeout
- `get_httpx_client() -> httpx.Client` - Get underlying sync client
- `get_async_httpx_client() -> httpx.AsyncClient` - Get underlying async client

### AuthenticatedClient

```python
from tektome.endpoints import AuthenticatedClient

client = AuthenticatedClient(
    base_url="https://gateway.tektome.com",
    token="your-api-key",
    prefix="Bearer",  # default
    auth_header_name="Authorization",  # default
)
```

**Additional Parameters:**
- `token: str` - Authentication token (required)
- `prefix: str` - Token prefix (default: "Bearer")
- `auth_header_name: str` - Header name (default: "Authorization")

---

## API Endpoints

Endpoints are organized by domain in `tektome.endpoints.api.*`:

| Module | Description |
|--------|-------------|
| `access` | Access control |
| `account` | Account management |
| `attribute` | Attribute operations |
| `bim` | BIM (Building Information Modeling) |
| `chats` | Chat functionality |
| `chunk_group` | Chunk group operations |
| `dataspace` | Dataspace management |
| `default` | Default endpoints |
| `entity_tracker` | Entity tracking |
| `extraction` | Document extraction |
| `folder` | Folder operations |
| `lawtalk_project` | Lawtalk project operations |
| `llm` | LLM operations |
| `observability` | Observability/monitoring |
| `organizations` | Organization management |
| `page` | Page operations |
| `payment_records` | Payment records |
| `project` | Project operations |
| `project_resource_group` | Project resource groups |
| `reports` | Reporting |
| `requirement` | Requirements |
| `requirement_research_templates` | Requirement research templates |
| `requirement_templates` | Requirement templates |
| `requirement_templates_container` | Requirement template containers |
| `resource` | Resource operations |
| `resource_group` | Resource groups |
| `sample` | Sample/test endpoints |
| `search` | Search functionality |
| `section` / `sections` | Section operations |
| `slack` | Slack integration |
| `storage_import` | Storage import |
| `tasks` | Task management |
| `tektome_backend` | Core backend |
| `tektome_os` | Tektome OS |
| `usage` | Usage tracking |
| `user` | User management |
| `utils` | Utility endpoints |
| `worker` | Worker operations |

---

## Types and Utilities

### UNSET
Sentinel value for optional parameters that weren't provided.

```python
from tektome.endpoints.types import UNSET, Unset

def api_call(param: str | Unset = UNSET):
    if param is UNSET:
        # parameter not provided
        pass
```

### File
File upload helper for multipart/form-data.

```python
from tektome.endpoints.types import File

file = File(
    payload=open("document.pdf", "rb"),
    file_name="document.pdf",
    mime_type="application/pdf"
)
```

### Response
Generic response wrapper from API calls.

```python
from tektome.endpoints.types import Response

# Response[T] contains:
# - status_code: HTTPStatus
# - content: bytes
# - headers: MutableMapping[str, str]
# - parsed: T | None
```

### UnexpectedStatus
Exception raised when API returns undocumented status code.

```python
from tektome.endpoints.errors import UnexpectedStatus

try:
    # API call
    pass
except UnexpectedStatus as e:
    print(f"Status: {e.status_code}")
    print(f"Content: {e.content}")
```

---

## Decorators

### parseio
Decorator that validates inputs with Pydantic and outputs with beartype. The return value is automatically converted to dict if it's a Pydantic model.

**Behavior:**
- Inputs: Validated/coerced using pydantic's `@validate_call` (dicts become models)
- Outputs: Type-checked using `@beartype`
- Return value: Converted to dict via `.model_dump()` if it's a Pydantic model

**Example:**
```python
from tektome import Context, Resource
from tektome.decorators import parseio

@parseio
def main(ctx: Context, r: Resource) -> dict:
    """Openflow function with automatic validation."""
    with ctx.client() as client:
        # make authenticated requests
        pass
    return {"status": "success", "resource_id": str(r.id)}
```

---

## Common Patterns

### Using with Openflow

```python
from tektome import Resource, Context
from tektome.decorators import parseio

@parseio
def main(ctx: Context, r: Resource) -> dict:
    """Openflow function with auto-injected context."""
    # Create authenticated client from context
    with ctx.client() as client:
        # make requests
        pass

    return {"result": "data to next step"}
```

### Working with Collections

```python
from tektome import Resources, Projects

def process_multiple(resources: Resources, projects: Projects):
    for resource_id in resources.ids:
        print(f"Resource: {resource_id}")
    for project_id in projects.ids:
        print(f"Project: {project_id}")
```

### Serialization

```python
from tektome import Resource

resource = Resource(
    id="123e4567-e89b-12d3-a456-426614174000",
    kind="resource"
)

# Convert to dict
data = resource.model_dump()

# Convert to JSON string
json_str = resource.model_dump_json()

# Create from dict
resource2 = Resource(**data)
```

---

## Validation

All classes use Pydantic for validation:

- **UUID Validation**: Automatically converts string UUIDs to UUID objects
- **Kind Validation**: Ensures correct type identifiers
- **Extra Field Protection**: Rejects unexpected fields
- **Type Safety**: Enforces correct types for all fields

**Example Errors:**
```python
# Wrong kind - raises ValidationError
resource = Resource(id="...", kind="invalid")
# ValidationError: kind must be 'resource'

# Extra field - raises ValidationError
resource = Resource(id="...", kind="resource", extra="not allowed")
# ValidationError: Extra inputs are not permitted
```

---

## Key Points for LLMs

1. **Field Names**: Use `id`/`ids` (not `uuid`/`uuids`) and `user_api_key` (not `api_key`)
2. **Kind Values**: Each class requires specific `kind` value that must match exactly
3. **Validation**: All classes validate UUID strings and convert to UUID objects
4. **Extra Fields**: All classes inherit BaseSchema which forbids extra fields
5. **Context Client**: Use `ctx.client()` to create authenticated client directly from context
6. **Default Base URL**: `https://gateway.tektome.com`
7. **Client Types**: Use `Client` for unauthenticated, `AuthenticatedClient` for authenticated requests
8. **Async Support**: Both clients support sync and async via context managers
9. **Decorator**: Use `@parseio` from `tektome.decorators` for input/output validation

---

## Dependencies

- `pydantic>=2.0.0` - Data validation
- `httpx>=0.23.0,<0.29.0` - HTTP client
- `attrs>=22.2.0` - Class definitions
- `python-dateutil>=2.8.0,<3` - Date utilities
- `beartype>=0.22.9` - Runtime type checking

## Version

Current version: 0.3.1

## Documentation

Full documentation: https://github.com/tektomejp/tektome_python

## License

MIT
